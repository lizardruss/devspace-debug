version: v2beta1
name: hot-reload-container-restart

vars:
  IMAGE: nginx

images:
  my-app:
    image: ${IMAGE}

deployments:
  my-app:
    helm:
      values:
        containers:
        - image: ${IMAGE}

dev:
  my-dev:
    imageSelector: ${IMAGE}
    command:
      - sleep infinity
    logs: {}
    ports:
    - port: 8080

commands:
  watch: |-
    run_watch \
      --fail-on-error \
      -p ./cmd/**/test.go \
      -p ./cmd/**/test2.go \
      -p ./pkg/**/test.go \
      -p ./pkg/**/test2.go \
      -- devspace dev "$@"